# IT_equipment_2.0

Была поставлена задача с высоким приоритетом по созданию новой версии (2.0) учета IT оборудования основываясь на существующую версию.

В версии 1.0 пристутствует 2 страницы: Оборудование и Логи. 
В версии 2.0 должны быть 5 страниц:
- переработанная страница Оборудование;
- Списанное оборудование;
- Настройка;
- переработанная страница Логи;
- страница импорта данных в Битрикс из файла .csv.

Каждая из страниц, за исключением страницы "Импорт", представляет из себя универсальный список с возможностью детального просмотра записи,
добавления, удаления и редактирования записи (по требованию заказчика некоторые функции были отключены, но остались в коде в виде комментариев).

---------------------------------
Страница + инфоблок "Настрока".

Представляет из себя список типов, к которым будут привязываться все записи. Возможность добавления и редактирования была отключена по требованию, потому как все типы будут заноситься в инфоблок из файла импорта.
---------------------------------
Страница + инфоблок "Обородувание".

Представляет из себя список всех записей. Поле "Тип" связано с инфоблоком настройка, так же на странице списка и на детальной странице поле "Тип" является ссылкой, которая ведет на страницу соответствующего типа на странице "Настройка".
Поля "Фактический пользователь" и "МОЛ" связаны со списком сотрудников. По ТЗ данное поле является ссылкой, которое ведет на страницу "Оборудование", где будут отображены все записи, в которых данных сотрудник присутствует как "Фактический пользователь" или "МОЛ".
На детальной странице ниже полей "Фактический пользователь" и "МОЛ" имеется ссылка "История перемещения", котороя ведет на страницу "Логи" и отображает только те записи, в которых было изменено соответствующее поле "Фактический пользователь" или "МОЛ".
На детальной странице присутствует кнопка "История перемещения МЦ", которая ведет на страницу "Логи", на которой отображаются только записи изменения полей соответствуеющего элемента.
На детальной странице присутствует кнопка "Списать оборудование", которая перенесит запись из инфоблока "Оборудование" в "Списанное оборудование".
На детальной странице пристуствует кнопка "Редактировать", котороая открывает форму редактирования различных полей записи. По требованию заказчика поля с технической информацией являются не редактируемыми как "защита от дурака".
Страница редактирования/добавления представляет собой список всех полей с возможностью редактирования. Такие поля, как "Тип", "Фактический пользователь" и "МОЛ" являются кастомными и представляют из себя поле ввода с выпадающим списком с возможностью поиска. 
Каждое из кастомных полей привязано к соответствующим инфоблокам и в выпадающем списке отображает список записей. При вводе инфомации для поиска неподходящие поля не отображаются в списке (подходящая аналогия это поисковая строка в браузере).
На странице со списком присутствует кнопка "Экспорт в Excel", которая сохраняет таблицу в файл.
Так же на странице со списком присутсвует поле поиска и фильтрации.

Возможность добавления новых записей по требованию заказчика отключена, потому как вся информация будет поступать из файла импорта.
---------------------------------
Страница + инфоблок "Списанное оборудование".

Представляет из себя копию страницы "Оборудование" со всем функционам, за исключением редактирования записей, данный функционал отключен.
На детальной странице присутствует кнопка "Восстановить оборудование", которая переносит запись из инфоблока "Списанное оборудование" в инфоблок "Оборудование".
---------------------------------
Страница + инфобок "Логи".

Любое действие с элементами, будь то редактивание или списание/восстановление логируется событием, которое добавляет в инфоблок запись, в которой сохраняется страрое значение и новое при редактивании, а при списании/восстановлении просто указывает, что элемент был
списан/ восстановлен.
На детальной странице отображеные все поля. Если поле было изменено, то в одну строку отображается старое и, справа от него, новое значение. Старое значение отображается красным цветом, новое зеленым.
Название каждой записи формируется из дествия "Элемент был изменен" или "Элемент был списан/восстановлен" + название самой записи.
На детальной странице под названием указывается пользователь, который сделал изменение.
В записи сохранется время и дата, когда было внесено изменение.
Так же в записи для удобства отображается название измененой записи, которое является ссылкой, ведущей на страницу соответствующей записи на страницу "Оборудование".
---------------------------------
Страница "Импорт".

Представляет из себя страницу, на которой можно импортировать файл формата .csv.
При импортировании файла отображается список заголовков столбцов из файла, каждому из которых необходимо в выпадающем списке напротив выбрать поле из инфоблока, в которое будет заноситься соответсвтующий столбец. Имеется автозаполнение, поэтому ручное изменение не обязательно.
Для удобства и во избежание ошибок от сервера реализована пакетная загрузка по 500 записей, котороя дробит записи из файла, с отображением количества загруженных записей из общего числа в реальном времени.
При закгрузке поле соответствующее типу проверяет, имеется ли такое в инфоблоке "Настройка". Если нет, то доабвляется новый тип, в ином случае указывает существующее.
У полей "Фактический пользователь" и "МОЛ" так же имеется проверка по сотрудникам. Если сотрудник был не найден, то информация будет занесена в поле "Примечание".
Если с какой-то строкой возникла ошибка, то так же в реальном времени выводится сообщение об ошибке, краткое описание ошибки и номер строки из файла.
Некоторые записи из файла игнорируются по требованию заказчика.
